# RideLane テスト手順
バージョン: 1.0.78  
更新日: 2026-02-28

## 1. 前提
- Xcode 17+
- iOS シミュレータ
- `Config/Weather.plist` 設定済み（詳細は `docs/API.md`）

## 2. ビルド
```bash
cd /Users/xingyang/cruisenavi
xcodebuild -project SeaNavi/RideLane.xcodeproj -scheme SeaNavi -destination 'generic/platform=iOS Simulator' build
```

## 3. 自動テスト
```bash
cd /Users/xingyang/cruisenavi
xcodebuild -project SeaNavi/RideLane.xcodeproj -scheme SeaNavi -destination 'platform=iOS Simulator,name=iPhone 17,OS=26.2' test
```
## 4. 手動確認
1. アプリ起動で Home 表示、下部中央バージョンが `ver1.0.78` になっている
2. Home の現在地地図がタイトルなし・角丸なしで横幅いっぱい表示になっている
3. Home 地図の上部中央に `splash` ロゴが表示される
4. Home 地図下に `ルートポイント` / `実GPS` / `GPSアクティブ` などのステータス文言が表示されていない
5. Home の `ver1.0.78` 表示が中央寄せになっている
6. 初回起動時にウォークスルー（5ステップ）が表示される
7. シミュレーターではウォークスルー完了後も再起動で再表示される（検証用挙動）
8. 実機ではウォークスルーを完了またはスキップ後、再起動しても再表示されない
9. ウォークスルー Step1 の `位置情報を有効化` で位置許可ダイアログが起動する
10. ウォークスルー Step3 の `目的地を開く` で目的地シートが開く
11. Home 上部に `今日の1本` 提案カードが表示され、`このルートで開始` でプレビューへ遷移する
12. `今日の1本` は `10.0〜50.0km` の候補のみ表示され、該当候補がない場合はカード自体が非表示になる
13. Home に `週次ミッション` カードが表示され、距離進捗が更新される
14. ナビ終了時に `ライドハイライト` シート（距離/平均速度/バッジ）が表示される
15. iOS設定の `RideLane > 言語` に言語選択が表示され、日本語/英語を選択できる
16. RideLane の言語を日本語に変更後、アプリ再起動でナビ中のルート案内文が日本語寄りに変わる（地図データ依存で英語地名が残る場合あり）
17. 目的地設定を開き、query未入力時に 10〜100km 圏内のおすすめ候補が表示される
18. 目的地設定でテキスト検索を入力すると 200km 圏内で候補が表示される
19. 目的地設定画面でルートモード（`平坦優先` / `ヒルクライム`）を切替できる
20. 候補選択後にプレビュー画面が表示される
21. スタートで Driving へ遷移し、案内カードが下部、ズームUIが右上、`終了`/`メニュー` が左上縦アイコンで表示される
22. ナビ中に一定時間放置しても画面が自動スリープ/自動ロックしない
23. 案内カード右上に「速度」「全体道のり」が2段表示され、次操作地点までの距離が右上に表示されない
24. 移動中に全体道のりがリアルタイムで減少し、停止時は速度が `0.0 km/h` に収束する
25. ルート上を進むと通過済み区間のルート線が後方から消える
26. 意図的にルートを外れると自動再ルートされ、短時間で連続再ルートしない
27. 位置情報 OFF 時に追跡状態が「位置情報なし」になる
28. 天気カードに天候・風速（m/s）・風向・路面リスクが表示される
29. 降雨が予測される場合「xx分後に雨が降る見込み」と表示される
30. ナビ終了後、Health 許可ダイアログを許可すると Apple Health にワークアウト（自転車）が追加される
31. ナビ開始前のプレビューまたはナビ中で、30〜60分先降雨がある場合に `雨回避アラート` バナーが表示される
32. `回避ルート提案` を押すと平坦優先で再ルートされ、ルートが更新される
33. Home 下部の `利用規約` を開くとアプリ内シートで `https://lp.xerographix.co.jp/ridelane/terms.html` が表示される
34. Home 下部の `プライバシー` を開くとアプリ内シートで `https://lp.xerographix.co.jp/ridelane/privacy.html` が表示される
35. 法務ページ内で `RideLane トップへ戻る` ボタンが表示されない
36. 一度オンラインで法務ページを開いた後、機内モードで再度開いてもページ内容が表示される（キャッシュ表示）

## 5. ログ確認
- ルート失敗時に警告文が表示されること
- 逸脱検知時に再ルート開始ログが出ること（DEBUG）
- 速度補完が使われたときに速度更新ログが出ること（DEBUG）
- API 失敗時に「気象データ更新に失敗」が表示されること
