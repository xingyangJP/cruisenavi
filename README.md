# RideLane 要件定義
バージョン: 1.0.84  
更新日: 2026-02-28

## 1. 概要
RideLane は iOS 向けの自転車ナビアプリです。現在地から目的地までの道路ルート案内、周辺スポット検索、走行ログ表示、天気リスク表示を提供します。

## 2. 対象環境
- iOS 18 以降
- SwiftUI / MapKit / CoreLocation
- Xcode 17+

## 3. 機能要件
- 現在地追跡（実 GPS、必要時のみモックフォールバック）
- 目的地検索（おすすめ: 現在地から 10〜100km / テキスト検索: 現在地から 200km 圏内、`MKLocalSearch`）
  - 検索結果の `☆` でお気に入り保存/解除
  - 検索画面先頭にお気に入り一覧を表示
- ルートモード切替（平坦優先 / ヒルクライム）
- ルートプレビュー（全体表示 + スタート/キャンセル）
- 走行ナビ（進行方向追従カメラ、ズーム UI、案内文表示）
  - 目的地到着時に到着メッセージを表示（演出）
- 雨回避アラート（30〜60分先の降雨予測 + 回避ルート提案）
- アプリ言語切替（iOS設定の `RideLane > 言語` で日本語/英語を選択可能）
- 走行ログ一覧
- 今日の1本提案（現在地・天候に応じた1タップ開始）
- お気に入りから出発（Homeの横スクロールから1タップ開始）
- 週次ミッション（今週40kmの進捗表示）
- ライド完了リワード（終了時ハイライト表示）
- 初回ウォークスルー（5ステップ、スキップ可、完了後は再表示しない）
- 天気情報表示（天候、風速[m/s]、風向、路面リスク、降雨予測）
- ライドログの Apple Health 同期（Workout / Route）
  - Homeから `Health連携について` で同期内容・目的を確認し、連携ON/OFFを切替可能
- Firebase Analytics による利用分析
  - `home_view` / `route_preview_open` / `nav_start` / `ride_complete` を送信
- アプリ内法務ページ表示（利用規約/プライバシーポリシー）
  - 対象URL:
    - `https://lp.xerographix.co.jp/ridelane/terms.html`
    - `https://lp.xerographix.co.jp/ridelane/privacy.html`
  - オフライン時は前回取得したHTMLキャッシュを表示
  - Webフッタの `RideLane トップへ戻る` ボタンはアプリ内表示時に非表示

## 4. 非機能要件
- ルート取得失敗時は危険な長距離直線を表示しない
- API 失敗時は警告文でユーザーに通知する
- 主要画面はライトテーマで視認性を優先する

## 5. データモデル
- `WeatherSnapshot`: 天候、風速、風向、路面リスク、降雨予測、警告レベル
- `Harbor`（名称は互換維持）: 目的地スポット情報
- `VoyageLog`: 走行ログ
- `RouteSummary`: ルート要約
